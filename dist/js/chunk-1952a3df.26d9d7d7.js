(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1952a3df"],{"15fd":function(e,t,r){"use strict";function o(e,t){if(null==e)return{};var r,o,n={},s=Object.keys(e);for(o=0;o<s.length;o++)r=s[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}function n(e,t){if(null==e)return{};var r,n,s=o(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}r.d(t,"a",(function(){return n}))},"488c":function(e,t,r){"use strict";var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",{staticClass:"crud-wrapper"},[e.login?e._t("default",[e._v(" vazio ")],{schema:e.schema}):r("div",{staticClass:"col-12 col-md-4 offset-md-4"},[e.loading?r("h3",{staticClass:"text-center"},[e._v("Authenticating..."),r("CSpinner",{attrs:{color:"info",size:"sm"}})],1):r("FormulateForm",{on:{submit:e.doAuth},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.hasErrors;return[r("h4",{staticClass:"text-center"},[e._v("Project Authentication")]),r("FormulateInput",{attrs:{type:"text",name:"username",placeholder:"Username"}}),r("FormulateInput",{attrs:{type:"password",name:"secret",placeholder:"Password"}}),r("FormulateInput",{attrs:{type:"checkbox",name:"remember",label:"remember"}}),r("div",{staticClass:"action-buttons mt-3"},[r("CButton",{staticClass:"mr-2",attrs:{type:"button",color:"danger"},on:{click:function(t){return e.$emit("close",{refresh:!1})}}},[e._v(" Cancel ")]),r("CButton",{attrs:{type:"submit",color:"success",disabled:o}},[e._v(" Save ")])],1)]}}]),model:{value:e.model,callback:function(t){e.model=t},expression:"model"}})],1)],2)},n=[],s=(r("96cf"),r("1da1")),a=r("15fd"),c=r("2ef0"),i=r("b288"),u={mixins:[i["a"]],props:{project:{type:Object,default:{}},schema:{type:Object,default:{}}},data:function(){return{loading:!1,model:{},login:!1}},methods:{doAuth:function(e){try{return this.loading=!0,this.authenticate(e).then(this.success).catch(this.error)}catch(t){this.error(t),this.loading=!1}},success:function(e){var t=this.storageToken(e),r=e.data,o=e.headers;if(!t)return this.loading=!1,this.$emit("auth:failed",{message:"token not found",config:config,data:r,headers:o});var n=this.authRequest(t);this.$emit("auth:logged",{logged:this.logged,request:n}),this.loading=!1,this.login=!0},error:function(e){var t=e.response,r=e.message,o=Object(a["a"])(e,["response","message"]);console.log("Auth Error",r,t,o),this.loading=!1,this.$emit("auth:failed",{message:r})},checkLogged:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.isLogged(e);case 3:return o=r.sent,console.debug("checkLogged: isLogged",o),t.$emit("auth:logged",o),r.abrupt("return",o);case 9:return r.prev=9,r.t0=r["catch"](0),console.debug("checkLogged failed: token",r.t0),t.login=!1,r.abrupt("return",t.$emit("auth:failed",{message:r.t0.message}));case 14:case"end":return r.stop()}}),r,null,[[0,9]])})))()}},beforeMount:function(){this.login=!1,console.log("caled before mount")},mounted:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,o,n,s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,console.debug("caled mounted auth"),e.hasAuth){t.next=4;break}return t.abrupt("return",e.login=!0);case 4:if(console.debug("auth process start"),r=sessionStorage.getItem("".concat(e.project.code,"_session")),console.debug("token session",r),e.loading=!0,!r||!Object(c["get"])(e.session,"logged",!1)){t.next=16;break}e.$emit("auth:logged",{token:r,user:Object(c["get"])(e.session,"user",{}),request:e.authRequest(r)}),console.debug("token and user exists",e.authRequest(r),e.session),e.schema.api=Object.assign(e.schema.api,e.authRequest(r)),e.loading=!1,e.login=!0,t.next=32;break;case 16:if(!r){t.next=29;break}return t.next=19,e.checkLogged(r);case 19:o=t.sent,n=o.request,s=void 0===n?{}:n,i=Object(a["a"])(o,["request"]),console.debug("token exists relogin",s,i),e.schema.api=Object.assign(e.schema.api,s),e.loading=!1,e.login=!0,t.next=32;break;case 29:e.loading=!1,e.login=!1,console.debug("show login form");case 32:t.next=40;break;case 34:t.prev=34,t.t0=t["catch"](0),e.login=!1,e.loading=!1,console.log("erro mounted auth",t.t0),e.$emit("auth:failed",t.t0);case 40:case"end":return t.stop()}}),t,null,[[0,34]])})))()}},l=u,d=r("2877"),h=Object(d["a"])(l,o,n,!1,null,null,null);t["a"]=h.exports},"57be":function(e,t,r){},b288:function(e,t,r){"use strict";r("b0c0"),r("d3b7");var o=r("5530"),n=r("ade3"),s=r("2ef0"),a=r("a74a"),c=r("e256");t["a"]={computed:{currentProject:function(){return this.$store.state.currentProject||null},config:function(){return this.project.auth||null},hasAuth:function(){return Object(s["has"])(this.currentProject,"auth")},showCrud:function(){return!this.hasAuth||this.hasAuth&&this.logged},logged:function(){return Object(s["get"])(this.$store,"state.auth.".concat(this.currentProject.code,".logged"),!1)},session:function(){return Object(s["get"])(this.$store,"state.auth.".concat(this.currentProject.code),!1)}},methods:{authenticate:function(e){var t=this,r=e.username,o=e.secret,a=e.remember;try{var i;return Object(s["has"])(this.config,"url_login")?Object(c["f"])(this.config.url_login,{method:Object(s["get"])(this.config,"url_method","post"),data:(i={},Object(n["a"])(i,Object(s["get"])(this.config,"field_username","email"),r),Object(n["a"])(i,Object(s["get"])(this.config,"field_secret","password"),o),Object(n["a"])(i,Object(s["get"])(this.config,"field_remember","remember"),a),i),headers:Object(n["a"])({},Object(s["get"])(this.config,"request_token","access-token"),"")},!1).then((function(e){var r=t.storageToken(e),o=t.authRequest(r);return t.$store.commit("setAuth",[t.currentProject.code,{request:o,logged:!0,token:r}]),e})):new Error("url login doest exist")}catch(u){return new Error(u)}},storageToken:function(e){var t=e.data,r=e.headers,o=null;return o="header"===Object(s["get"])(this.config,"response_mode","body")?r[Object(s["get"])(this.config,"response_token","access-token")]:Object(s["get"])(t,Object(s["get"])(this.config,"response_token","access_token"),"token"),o?(sessionStorage.setItem("".concat(this.project.code,"_session"),o),o):new Error({message:"token not found",config:this.config,data:t,headers:r})},isLogged:function(e){var t=this;try{if(!Object(s["has"])(this.config,"logged_url"))return Promise.reject({message:"Logged url not found"});var r=this.authRequest(e),n=Object(o["a"])({method:"get"},r);return Object(c["f"])(Object(s["get"])(this.config,"logged_url"),n).then((function(o){var n=t.setUser(o);return t.$store.commit("setAuth",[t.currentProject.code,{user:n,request:r,logged:!0,token:e}]),{token:e,user:n,request:r}}))}catch(a){return Promise.reject({message:a.message})}},authRequest:function(e){var t=Object(s["get"])(this.config,"request_token_expression","{token}");return"query"==Object(s["get"])(this.config,"request_mode","header")?{params:Object(n["a"])({},Object(s["get"])(this.config,"request_token","access-token"),Object(a["e"])(t,{token:e}))}:{headers:Object(n["a"])({},Object(s["get"])(this.config,"request_token","access-token"),Object(a["e"])(t,{token:e}))}},setUser:function(e){if(!Object(s["has"])(this.config,"logged_model"))return{};var t=Object(s["get"])(this.config,"logged_model"),r=t.id,o=t.name,n=t.username,a=t.role,c={id:Object(s["get"])(e,r,"id"),name:Object(s["get"])(e,o,"name"),username:Object(s["get"])(e,n,"email"),role:Object(s["get"])(e,a,"level")};return c}}}},d0b1:function(e,t,r){"use strict";var o=r("57be"),n=r.n(o);n.a},d594:function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("CRow",[r("CCol",{attrs:{col:""}},[r("CCard",[r("CCardHeader",[r("strong",[e._v(e._s(e.currentProject.name)+" | "+e._s(e.active.title))]),r("div",{staticClass:"card-header-actions"},[e.session?r("span",[e._v("Logged as "+e._s(e.session.user.name?e.session.user.name:"anonimous")+" | ")]):e._e(),r("CButton",{staticClass:"card-header-action",attrs:{size:"sm"},on:{click:function(t){return e.loadModel({cache:{ignoreCache:!0}})}}},[r("CIcon",{attrs:{name:"cil-reload"}}),e._v(" Model ")],1)],1)]),r("CCardBody",[e.renderComponent?r("section",[r("Auth",{attrs:{project:e.currentProject,schema:e.active},on:{"auth:logged":e.auth,"auth:failed":e.errors},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.schema;return[o.api?r("Table",{ref:"tables",attrs:{schema:o},on:{"actions:create":function(t){return e.actions("FORM_CREATE",t)},"actions:edit":function(t){return e.actions("FORM_EDIT",t)}}}):e._e(),r("CModal",{attrs:{title:e.formTitle,show:e.formopen,size:"lg",closeOnBackdrop:!1},on:{"update:show":function(t){e.formopen=t}}},[e.formopen?r("Forms",{attrs:{formopen:e.formopen,schema:o,data:e.row},on:{"model:saved":e.formHook,close:e.closeForm}}):e._e(),r("template",{slot:"footer"},[r("span")])],2)]}}],null,!1,2767369388)})],1):r("h4",{staticClass:"text-center"},[r("CSpinner",{attrs:{color:"info"}})],1)])],1)],1)],1)},n=[],s=(r("99af"),r("d81d"),r("b64b"),r("d3b7"),r("3ca3"),r("ddb0"),r("15fd")),a=r("5530"),c=(r("96cf"),r("1da1")),i=r("2ef0"),u=r("fbaa"),l=r("b288"),d=r("488c"),h=r("dc4e"),g=r("dae8"),f={name:"Base",mixins:[u["a"],l["a"]],components:{Auth:d["a"],Table:h["a"],Forms:g["a"]},data:function(){return{models:{},row:{},formopen:!1,formLogin:!0}},watch:{$route:function(e,t){e.params.model!=t.params.model&&this.loadModel({cache:{ignoreCache:!0}})},currentProject:function(e,t){if(Object(i["has"])(this.currentProject,"code")&&!t.code)this.loadModel();else if(Object(i["has"])(this.currentProject,"code")&&this.currentProject.code!==e.code){var r=Object.keys(e.resources);this.$router.push("/api/".concat(e.code,"/").concat(r[0]))}}},mounted:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:Object(i["has"])(e.currentProject,"code")&&e.loadModel();case 1:case"end":return t.stop()}}),t)})))()},computed:{formTitle:function(){return this.row&&this.row.id?"Update ".concat(this.active.title," | ID: ").concat(this.row.id):"New ".concat(this.active.title)},crud:function(){return this.$store.state.crud||{}}},methods:{reloadData:function(){this.$refs.tables.fetchData({type:"pageChange"}),this.formopen=!1},closeForm:function(e){var t=e.refresh;t&&this.reloadData(),this.formopen=!1,this.$store.commit("set",["crud",Object(a["a"])(Object(a["a"])({},this.crud),{},{row:null})])},actions:function(e,t){var r=this;if("FORM_CREATE"==e)this.formopen=!0,this.row={},this.$store.commit("set",["crud",Object(a["a"])(Object(a["a"])({},this.crud),{},{row:{}})]);else if("FORM_EDIT"==e)this.formopen=!0,this.row=Object(a["a"])({},t),this.$store.commit("set",["crud",Object(a["a"])(Object(a["a"])({},this.crud),{},{row:this.row})]);else if("FORM_DELETE"==e)this.deleteData(t).then((function(){r.$message("Successfully deleted!"),r.reloadData()}));else if("FORM_DELETEBATCH"==e){var o=t&&t.map((function(e){return r.deleteData(row)}));Promise.all(o).catch((function(e){return r.$message(e.message,"danger")})).then((function(e){return r.$message("All rows delete successfully")}))}},auth:function(e){var t=e.request,r=void 0===t?{}:t;Object(s["a"])(e,["request"]);return console.log("logged base api",r),this.active.api=Object.assign(this.active.api,r),r},formHook:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.saveData(t.active,e).then((function(e){return t.closeForm({refresh:!0}),e}));case 3:return r.abrupt("return",r.sent);case 6:r.prev=6,r.t0=r["catch"](0),console.debug("Form submit error",r.t0);case 9:case"end":return r.stop()}}),r,null,[[0,6]])})))()}}},m=f,b=(r("d0b1"),r("2877")),p=Object(b["a"])(m,o,n,!1,null,null,null);t["default"]=p.exports}}]);
//# sourceMappingURL=chunk-1952a3df.26d9d7d7.js.map