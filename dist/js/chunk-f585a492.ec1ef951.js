(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f585a492"],{"15fd":function(e,t,o){"use strict";function r(e,t){if(null==e)return{};var o,r,s={},a=Object.keys(e);for(r=0;r<a.length;r++)o=a[r],t.indexOf(o)>=0||(s[o]=e[o]);return s}function s(e,t){if(null==e)return{};var o,s,a=r(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(s=0;s<n.length;s++)o=n[s],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}o.d(t,"a",(function(){return s}))},"2b54":function(e,t,o){"use strict";o.r(t);var r=function(){var e=this,t=this,o=t.$createElement,r=t._self._c||o;return r("div",[r("CCard",[r("CCardHeader",[r("CIcon",{attrs:{name:"cil-drop"}}),r("span",[t._v(" Playground")]),r("div",{staticClass:"card-header-actions"},[t.currentProject?r("select",{directives:[{name:"model",rawName:"v-model",value:t.model,expression:"model"}],on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));t.model=e.target.multiple?o:o[0]}}},t._l(t.optionfy(t.models,"label","resource"),(function(e){return r("option",{key:e.value,domProps:{value:e.value,textContent:t._s(e.label)}})})),0):t._e(),r("CButton",{attrs:{type:"button"},on:{click:t.reloadProjects}},[r("CIcon",{attrs:{name:"cil-reload"}}),t._v(" Projects")],1)],1)],1),r("CCardBody",[r("CRow",[r("CCol",{attrs:{lg:"7"}},[r("CButton",{staticClass:"float-right",on:{click:t.forceRerender}},[r("CIcon",{attrs:{name:"cil-reload"}}),t._v(" Update View")],1),t.currentProject&&t.active?r("Auth",{attrs:{project:t.currentProject,schema:t.active},on:{"auth:logged":t.auth,"auth:failed":t.errors},scopedSlots:t._u([{key:"default",fn:function(e){var o=e.schema;return[r("CTabs",{attrs:{variant:"pills","active-tab":0}},[t.active?r("CTab",{attrs:{title:"Form"}},[o.properties&&t.render?r("Forms",{attrs:{schema:o,data:t.row},on:{"model:saved":t.submitHandler}}):t._e()],1):t._e(),t.active?r("CTab",{attrs:{title:"Table"}},[o.api&&t.render?r("Table",{ref:"tables",attrs:{schema:o},on:{"actions:create":function(e){return t.actionsTable("FORM_CREATE",e)},"actions:edit":function(e){return t.actionsTable("FORM_EDIT",e)}}}):r("span",[t._v("Login required")])],1):t._e()],1)]}}],null,!1,1097224385)}):t._e()],1),r("CCol",{staticStyle:{"min-height":"500px"},attrs:{lg:"5"}},[r("select",{directives:[{name:"model",rawName:"v-model",value:t.jsonEditorData,expression:"jsonEditorData"}],on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));t.jsonEditorData=e.target.multiple?o:o[0]}}},[r("option",{attrs:{value:"project"}},[t._v("Project")]),r("option",{attrs:{value:"model"}},[t._v("Model")]),r("option",{attrs:{value:"row"}},[t._v("Form values")]),r("option",{attrs:{value:"result"}},[t._v("Result")])]),r("CButton",{attrs:{type:"button"},on:{click:function(e){return t.newJson(t.jsonEditorData)}}},[r("CIcon",{attrs:{name:"cil-plus"}}),t._v(" New "+t._s(t.jsonEditorData))],1),"project"==t.jsonEditorData?r("VJsoneditor",{attrs:{height:"100%",options:{mode:"code"}},model:{value:t.currentProject,callback:function(e){t.currentProject=e},expression:"currentProject"}}):"model"==t.jsonEditorData?r("VJsoneditor",{attrs:{height:"100%",options:{mode:"code"}},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}}):"row"==t.jsonEditorData?r("VJsoneditor",{attrs:{height:"100%",options:{mode:"code"}},model:{value:t.row,callback:function(e){t.row=e},expression:"row"}}):"result"==t.jsonEditorData?r("VJsoneditor",{attrs:{height:"100%",options:{mode:"code"}},model:{value:t.submit,callback:function(e){t.submit=e},expression:"submit"}}):t._e()],1)],1)],1)],1),r("CModal",{attrs:{title:"New item",show:t.addModal.show,size:"lg",closeOnBackdrop:!1},on:{"update:show":function(e){return t.$set(t.addModal,"show",e)}}},["project"==t.addModal.type?r("NewProject"):t._e(),"model"==t.addModal.type?r("NewModel",{on:{model:function(t){return e.active=t}}}):t._e()],1)],1)},s=[],a=(o("d81d"),o("07ac"),o("5530")),n=o("fbaa"),c=o("b288"),i=o("e256"),u=o("2ef0"),l=o("bcb2"),d=o.n(l),m=o("488c"),h=o("dc4e"),f=o("dae8"),g=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("FormulateForm",{model:{value:e.form,callback:function(t){e.form=t},expression:"form"}},[o("h4",[e._v("Project setting")]),o("CRow",[o("FormulateInput",{staticClass:"col",attrs:{label:"Label",name:"name"}}),o("FormulateInput",{staticClass:"col",attrs:{label:"Slug",name:"code"}}),o("FormulateInput",{staticClass:"col",attrs:{label:"Site URL",name:"url"}}),o("FormulateInput",{staticClass:"col",attrs:{label:"Resource base path",name:"resources_path",value:"/models/"}})],1),o("p",[e._v("Resources:")]),e._l(e.form.resources,(function(t,r){return o("p",{key:r},[e._v("Name: "+e._s(t.label)+" - Path: "+e._s(t.resource))])}))],2),o("hr"),o("div",{staticClass:"Add Resource mb-5"},[o("h4",[e._v("New Resource")]),o("CRow",[o("FormulateInput",{staticClass:"col",attrs:{validation:"required",label:"Slug"},model:{value:e.resource.slug,callback:function(t){e.$set(e.resource,"slug",t)},expression:"resource.slug"}}),o("FormulateInput",{staticClass:"col",attrs:{label:"Label"},model:{value:e.resource.label,callback:function(t){e.$set(e.resource,"label",t)},expression:"resource.label"}}),o("FormulateInput",{staticClass:"col",attrs:{label:"Resource file/path"},model:{value:e.resource.resource,callback:function(t){e.$set(e.resource,"resource",t)},expression:"resource.resource"}})],1),o("button",{staticClass:"btn btn-info",on:{click:e.addResource}},[e._v("Add Resource")])],1),o("hr"),o("button",{staticClass:"btn btn-success",on:{click:e.addProject}},[e._v("Add project")])],1)},p=[],b={data:function(){return{form:{resources:{}},resource:{}}},computed:{projects:function(){return this.$store.state.projects}},methods:{addResource:function(){this.form.resources[this.resource.slug]={resource:this.resource.resource,label:this.resource.label},this.resource={},this.$message("Resource added")},addProject:function(){var e=this.projects;e.push(this.form),this.$store.commit("set",["projects",e]),this.$message("Project added. You should copy and save on json file/api"),this.form={resources:[]}}}},v=b,j=o("2877"),_=Object(j["a"])(v,g,p,!1,null,null,null),k=_.exports,O=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("h4",[e._v("Project setting")]),o("CRow",[o("FormulateInput",{staticClass:"col",attrs:{label:"Title"},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}}),o("FormulateInput",{staticClass:"col",attrs:{label:"Slug",help:"(same project config)"},model:{value:e.form.domain,callback:function(t){e.$set(e.form,"domain",t)},expression:"form.domain"}}),o("FormulateInput",{staticClass:"col",attrs:{label:"Primary Key"},model:{value:e.form.primaryKey,callback:function(t){e.$set(e.form,"primaryKey",t)},expression:"form.primaryKey"}})],1),o("CRow",[o("FormulateInput",{staticClass:"col",attrs:{label:"Api Base URL"},model:{value:e.form.api.rootApi,callback:function(t){e.$set(e.form.api,"rootApi",t)},expression:"form.api.rootApi"}}),o("FormulateInput",{staticClass:"col",attrs:{label:"Response array",value:null},model:{value:e.form.api.wrapData,callback:function(t){e.$set(e.form.api,"wrapData",t)},expression:"form.api.wrapData"}}),o("FormulateInput",{staticClass:"col",attrs:{label:"Response count",value:null},model:{value:e.form.api.totalData,callback:function(t){e.$set(e.form.api,"totalData",t)},expression:"form.api.totalData"}})],1),o("hr"),o("button",{staticClass:"btn btn-success",on:{click:e.addProject}},[e._v("Add Model")])],1)},w=[],C={data:function(){return{form:{type:"object",properties:[],api:{}}}},computed:{},methods:{addProject:function(){this.$emit("model",this.form),this.$message("Project added. You should copy and save on json file/api"),this.form={type:"object",properties:[],api:{}}}}},y=C,x=Object(j["a"])(y,O,w,!1,null,null,null),P=x.exports,$={mixins:[n["a"],c["a"]],components:{VJsoneditor:d.a,Forms:f["a"],Table:h["a"],Auth:m["a"],NewProject:k,NewModel:P},data:function(){return{render:!0,jsonEditorData:"project",project:null,model:null,active:null,row:{},submit:{},addModal:{}}},watch:{currentProject:function(e,t){e&&this.forceRerender()},model:function(e){e&&this.getModel(e),this.forceRerender()},row:function(e){this.$store.commit("set",["crud",Object(a["a"])(Object(a["a"])({},this.crud),{},{row:e})])}},computed:{models:function(){return Object.values(Object(u["get"])(this.currentProject,"resources",{}))},hasAuth:function(){return this.currentProject&&!!this.currentProject.auth},crud:function(){return this.$store.state.crud||{}}},methods:{actionsTable:function(e,t){console.debug("action table",t),this.row=t,this.$message("Row added to form values")},getModel:function(e){var t=this;return Object(i["f"])(this.currentProject.resources_path+e,{cache:{ignoreCache:!0}}).then((function(e){if(!e.api)return alert("Model load error");t.active=e,t.$store.commit("set",["crud",Object(a["a"])(Object(a["a"])({},t.crud),{},{row:t.row})])}))},newJson:function(e){this.addModal={show:!0,type:e},this.logged=!0,"model"==e&&(this.model=null)},optionfy:function(e,t,o){return e&&e.map((function(e){return{label:e[t],value:e[o]}}))},auth:function(e){var t=e.authRequest;this.active.api=Object.assign(this.active.api,t),this.logged=!0,this.$message("Success logged"),this.forceRerender()},errors:function(e){this.$message(e.message||e),console.log("error",e)},reloadProjects:function(){var e=this;Object(i["e"])({cache:{ignoreCache:!0}}).then((function(t){e.$store.commit("set",["projects",t])}))},forceRerender:function(){var e=this;console.log("changed"),this.render=!1,this.$nextTick((function(){e.render=!0}))},submitHandler:function(e){this.submit=e,this.$message("Data saved in result on json viewer")}}},R=$,F=Object(j["a"])(R,r,s,!1,null,null,null);t["default"]=F.exports},"488c":function(e,t,o){"use strict";var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("section",{staticClass:"crud-wrapper"},[e.login?e._t("default",[e._v(" vazio ")],{schema:e.schema}):o("div",{staticClass:"col-12 col-md-4 offset-md-4"},[e.loading?o("h3",{staticClass:"text-center"},[e._v("Authenticating..."),o("CSpinner",{attrs:{color:"info",size:"sm"}})],1):o("FormulateForm",{on:{submit:e.doAuth},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.hasErrors;return[o("h4",{staticClass:"text-center"},[e._v("Project Authentication")]),o("FormulateInput",{attrs:{type:"text",name:"username",placeholder:"Username"}}),o("FormulateInput",{attrs:{type:"password",name:"secret",placeholder:"Password"}}),o("FormulateInput",{attrs:{type:"checkbox",name:"remember",label:"remember"}}),o("div",{staticClass:"action-buttons mt-3"},[o("CButton",{staticClass:"mr-2",attrs:{type:"button",color:"danger"},on:{click:function(t){return e.$emit("close",{refresh:!1})}}},[e._v(" Cancel ")]),o("CButton",{attrs:{type:"submit",color:"success",disabled:r}},[e._v(" Save ")])],1)]}}]),model:{value:e.model,callback:function(t){e.model=t},expression:"model"}})],1)],2)},s=[],a=(o("96cf"),o("1da1")),n=o("15fd"),c=o("2ef0"),i=o("b288"),u={mixins:[i["a"]],props:{project:{type:Object,default:{}},schema:{type:Object,default:{}}},data:function(){return{loading:!1,model:{},login:!1}},methods:{doAuth:function(e){try{return this.loading=!0,this.authenticate(e).then(this.success).catch(this.error)}catch(t){this.error(t),this.loading=!1}},success:function(e){var t=this.storageToken(e),o=e.data,r=e.headers;if(!t)return this.loading=!1,this.$emit("auth:failed",{message:"token not found",config:config,data:o,headers:r});var s=this.authRequest(t);this.$emit("auth:logged",{logged:this.logged,request:s}),this.loading=!1,this.login=!0},error:function(e){var t=e.response,o=e.message,r=Object(n["a"])(e,["response","message"]);console.log("Auth Error",o,t,r),this.loading=!1,this.$emit("auth:failed",{message:o})},checkLogged:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function o(){var r;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,t.isLogged(e);case 3:return r=o.sent,console.debug("checkLogged: isLogged",r),t.$emit("auth:logged",r),o.abrupt("return",r);case 9:return o.prev=9,o.t0=o["catch"](0),console.debug("checkLogged failed: token",o.t0),t.login=!1,o.abrupt("return",t.$emit("auth:failed",{message:o.t0.message}));case 14:case"end":return o.stop()}}),o,null,[[0,9]])})))()}},beforeMount:function(){this.login=!1,console.log("caled before mount")},mounted:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var o,r,s,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,console.debug("caled mounted auth"),e.hasAuth){t.next=4;break}return t.abrupt("return",e.login=!0);case 4:if(console.debug("auth process start"),o=sessionStorage.getItem("".concat(e.project.code,"_session")),console.debug("token session",o),e.loading=!0,!o||!Object(c["get"])(e.session,"logged",!1)){t.next=16;break}e.$emit("auth:logged",{token:o,user:Object(c["get"])(e.session,"user",{}),request:e.authRequest(o)}),console.debug("token and user exists",e.authRequest(o),e.session),e.schema.api=Object.assign(e.schema.api,e.authRequest(o)),e.loading=!1,e.login=!0,t.next=32;break;case 16:if(!o){t.next=29;break}return t.next=19,e.checkLogged(o);case 19:r=t.sent,s=r.request,a=void 0===s?{}:s,i=Object(n["a"])(r,["request"]),console.debug("token exists relogin",a,i),e.schema.api=Object.assign(e.schema.api,a),e.loading=!1,e.login=!0,t.next=32;break;case 29:e.loading=!1,e.login=!1,console.debug("show login form");case 32:t.next=40;break;case 34:t.prev=34,t.t0=t["catch"](0),e.login=!1,e.loading=!1,console.log("erro mounted auth",t.t0),e.$emit("auth:failed",t.t0);case 40:case"end":return t.stop()}}),t,null,[[0,34]])})))()}},l=u,d=o("2877"),m=Object(d["a"])(l,r,s,!1,null,null,null);t["a"]=m.exports},b288:function(e,t,o){"use strict";o("b0c0"),o("d3b7");var r=o("5530"),s=o("ade3"),a=o("2ef0"),n=o("a74a"),c=o("e256");t["a"]={computed:{currentProject:function(){return this.$store.state.currentProject||null},config:function(){return this.project.auth||null},hasAuth:function(){return Object(a["has"])(this.currentProject,"auth")},showCrud:function(){return!this.hasAuth||this.hasAuth&&this.logged},logged:function(){return Object(a["get"])(this.$store,"state.auth.".concat(this.currentProject.code,".logged"),!1)},session:function(){return Object(a["get"])(this.$store,"state.auth.".concat(this.currentProject.code),!1)}},methods:{authenticate:function(e){var t=this,o=e.username,r=e.secret,n=e.remember;try{var i;return Object(a["has"])(this.config,"url_login")?Object(c["f"])(this.config.url_login,{method:Object(a["get"])(this.config,"url_method","post"),data:(i={},Object(s["a"])(i,Object(a["get"])(this.config,"field_username","email"),o),Object(s["a"])(i,Object(a["get"])(this.config,"field_secret","password"),r),Object(s["a"])(i,Object(a["get"])(this.config,"field_remember","remember"),n),i),headers:Object(s["a"])({},Object(a["get"])(this.config,"request_token","access-token"),"")},!1).then((function(e){var o=t.storageToken(e),r=t.authRequest(o);return t.$store.commit("setAuth",[t.currentProject.code,{request:r,logged:!0,token:o}]),e})):new Error("url login doest exist")}catch(u){return new Error(u)}},storageToken:function(e){var t=e.data,o=e.headers,r=null;return r="header"===Object(a["get"])(this.config,"response_mode","body")?o[Object(a["get"])(this.config,"response_token","access-token")]:Object(a["get"])(t,Object(a["get"])(this.config,"response_token","access_token"),"token"),r?(sessionStorage.setItem("".concat(this.project.code,"_session"),r),r):new Error({message:"token not found",config:this.config,data:t,headers:o})},isLogged:function(e){var t=this;try{if(!Object(a["has"])(this.config,"logged_url"))return Promise.reject({message:"Logged url not found"});var o=this.authRequest(e),s=Object(r["a"])({method:"get"},o);return Object(c["f"])(Object(a["get"])(this.config,"logged_url"),s).then((function(r){var s=t.setUser(r);return t.$store.commit("setAuth",[t.currentProject.code,{user:s,request:o,logged:!0,token:e}]),{token:e,user:s,request:o}}))}catch(n){return Promise.reject({message:n.message})}},authRequest:function(e){var t=Object(a["get"])(this.config,"request_token_expression","{token}");return"query"==Object(a["get"])(this.config,"request_mode","header")?{params:Object(s["a"])({},Object(a["get"])(this.config,"request_token","access-token"),Object(n["e"])(t,{token:e}))}:{headers:Object(s["a"])({},Object(a["get"])(this.config,"request_token","access-token"),Object(n["e"])(t,{token:e}))}},setUser:function(e){if(!Object(a["has"])(this.config,"logged_model"))return{};var t=Object(a["get"])(this.config,"logged_model"),o=t.id,r=t.name,s=t.username,n=t.role,c={id:Object(a["get"])(e,o,"id"),name:Object(a["get"])(e,r,"name"),username:Object(a["get"])(e,s,"email"),role:Object(a["get"])(e,n,"level")};return c}}}}}]);
//# sourceMappingURL=chunk-f585a492.ec1ef951.js.map